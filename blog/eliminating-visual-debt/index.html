<!DOCTYPE html>
<html>
    <head>
        <title>Eliminating Visual Debt</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Visual debt clutters the screen, increases code to be read and understood, makes us less productive and makes us focus on things that don&#039;t matter">
        <link href="https://ocramius.github.io/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="https://ocramius.github.io/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="https://ocramius.github.io/font/stylesheet.css" rel="stylesheet" type="text/css" />
        <link href="https://ocramius.github.io/css/menu_bubble.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" type="text/css" href="https://ocramius.github.io/css/normalize.css" />
        <link rel="stylesheet" type="text/css" href="https://ocramius.github.io/css/demo.css" />
        <link rel="stylesheet" type="text/css" href="https://ocramius.github.io/font/font-awesome-4.2.0/css/font-awesome.min.css" />
        <link href="https://ocramius.github.io/img/marco-pivetta-ocramius.gif" rel="shortcut icon"/>
        <link rel="stylesheet" href="https://ocramius.github.io/components/highlightjs/styles/github.css" />
        <link href="https://ocramius.github.io/css/style.css" rel="stylesheet" type="text/css" />
        <link rel="alternate" type="application/atom+xml" href="https://ocramius.github.io/atom.xml" title=" activity feed" />
    </head>
    <script src="https://ocramius.github.io/js/snap.svg-min.js"></script>
    <body>
        <div class="container">

            <div class='menu-wrap'>
                <nav class="menu">
                    <div class="icon-list">
                        <a href="https://ocramius.github.io/"><i class="fa fa-fw fa-newspaper-o"></i><span>Latest Posts</span></a>
                        <a href="https://ocramius.github.io/blog"><i class="fa fa-fw fa-comment-o"></i><span>Archive</span></a>
                        <a href="https://ocramius.github.io/talks"><i class="fa fa-fw fa-youtube"></i><span>Presentations</span></a>
                        <a href="https://ocramius.github.io/joindin"><i class="fa fa-fw fa-star-o"></i><span>Talks</span></a>
                        <a href="https://ocramius.github.io/about"><i class="fa fa-fw fa-user"></i><span>About</span></a>                        <a href="https://twitter.com/Ocramius" rel="me" title="Ocramius twitter profile" target="_blank"><i class="fa fa-fw fa-twitter"></i><span>Twitter</span></a>                        <a href="https://github.com/Ocramius" rel="me" title="Ocramius github profile" target="_blank"><i class="fa fa-fw fa-github"></i><span>Github</span></a>                    </div>
                </nav>                <button class="close-button" id="close-button">Close Menu</button>                <div class="morph-shape" id="morph-shape" data-morph-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">
                        <path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"/>
                    </svg>
                </div>
            </div>            <button class="menu-button" id="open-button">Open Menu</button>
            <div class="content-wrap">
                <div class="content">
                    <div class="top left">
                        <p id="shield-container" class="logo-cont left" style="width: 200px; padding: 0; margin: 0; height: 200px;
"></p>                        <h2 class="left text-center">Marco Pivetta <span>(<a href="//twitter.com/Ocramius" target="blank">Ocramius</a>)</span></h2>                    </div>

                    <div class="clear"></div>
                    <p class="text-center remove-margin">
                        <img src="https://ocramius.github.io/img/separator.png" alt=""/>
                    </p>
                    <div class="row-fluid">
                        <div class="span12">    <article>
        <header>
            <h1>Eliminating Visual Debt</h1>
        </header>
        <div><p>
    Today we're talking about <strong>Visual debt</strong> in our code.
</p>

<p>
    As an introduction, I suggest to watch
    <a href="https://laracasts.com/series/php-bits/episodes/1" target="_blank">
        this short tutorial
    </a>
    about visual debt by
    <a href="https://twitter.com/jeffrey_way" target="_blank">@jeffrey_way</a>.
</p>

<p>
    The concept is simple: let's take the example from Laracasts and re-visit
    the steps taken to remove visual debt.
</p>

<pre><code class="php">interface EventInterface {
    public function listen(string $name, callable $handler) : void;
    public function fire(string $name) : bool;
}

final class Event implements EventInterface {
    protected $events = [];

    public function listen(string $name, callable $handler) : void
    {
        $this-&gt;events[$name][] = $handler;
    }

    public function fire(string $name) : bool
    {
        if (! array_key_exists($name, $this-&gt;events)) {
            return false;
        }

        foreach ($this-&gt;events[$name] as $event) {
            $event();
        }

        return true;
    }
}

$event = new Event;

$event-&gt;listen('subscribed', function () {
    var_dump('handling it');
});

$event-&gt;listen('subscribed', function () {
    var_dump('handling it again');
});

$event-&gt;fire('subscribed');
</code></pre>

<p>
    So far, so good.
</p>

<p>
    We have an event that obviously fires itself, a concrete
    implementation and a few subscribers.
</p>

<p>
    Our code works, but it contains a lot of useless artifacts
    that do not really influence our ability to make it run.
</p>

<p>
    These artifacts are also distracting, moving our focus from
    the runtime to the declarative requirements of the code.
</p>

<p>
    Let's start removing the bits that aren't needed by starting
    from the method parameter and return type declarations:
</p>

<pre><code class="php">interface EventInterface {
    public function listen($name, $handler);
    public function fire($name);
}

final class Event implements EventInterface {
    protected $events = [];

    public function listen($name, $handler)
    {
        $this-&gt;events[$name][] = $handler;
    }

    public function fire($name)
    {
        if (! array_key_exists($name, $this-&gt;events)) {
            return false;
        }

        foreach ($this-&gt;events[$name] as $event) {
            $event();
        }

        return true;
    }
}
</code></pre>

<p>
    Our code is obvious, so the parameters don't need
    redundant declarations or type checks. Also, we are
    aware of our own implementation, so the runtime checks
    are not needed, as the code will work correctly as per
    manual or end to end testing. A quick read will also
    provide sufficient proof of correctness.
</p>

<p>
    Since the code is trivial and we know what we are doing
    when using it, we can remove also the contract that
    dictates the intended usage. Let's remove those
    <code>implements</code> and <code>interface</code> symbols.
</p>

<pre><code class="php">final class Event {
    protected $events = [];

    public function listen($name, $handler)
    {
        $this-&gt;events[$name][] = $handler;
    }

    public function fire($name)
    {
        if (! array_key_exists($name, $this-&gt;events)) {
            return false;
        }

        foreach ($this-&gt;events[$name] as $event) {
            $event();
        }

        return true;
    }
}
</code></pre>

<p>
    Removing the contract doesn't change the runtime
    behavior of our code, which is still technically
    correct. Consumers will also not need to worry
    about correctness when they use `Event`, as a
    quick skim over the implementation will reveal
    its intended usage.
</p>

<p>
    Also, since the code imposes no limitations on the
    consumer, who is responsible for the correctness
    of any code touching ours, we are not going to limit
    the usage of inheritance.
</p>

<pre><code class="php">class Event {
    // ... 
}
</code></pre>

<p>
    That's as far as the video goes, with a note that
    the point is to "question everything".
</p>

<h2>Bringing it further</h2>

<p>
    Jeffrey then pushed this a bit further, saying that
    best practices don't exist, and people are pretty
    much copying stale discussions about coding approaches:
</p>

<div data-tweet-id="869265813857075200" class="twitter-tweet"></div>

<p>
    According to that, I'm going to question the naming
    chosen for our code. Since the code is trivial and 
    understandable at first glance, we don't need to pick
    meaningful names for variables, methods and classes:
</p>

<pre><code class="php">class A {
    protected $a = [];

    public function a1($a1, $a2)
    {
        $this-&gt;a[$a1][] = $a2;
    }

    public function a2($a1)
    {
        if (! array_key_exists($a1, $this-&gt;a)) {
            return false;
        }

        foreach ($this-&gt;a[$a1] as $a) {
            $a();
        }

        return true;
    }
}
</code></pre>

<p>
    This effectively removes our need to look at the
    code details, making the code shorter and
    runtime-friendly. We're also saving some space
    in the PHP engine!
</p>

<p>
    Effectively, this shows us that
    there are upsides to this approach, as we move
    from read overhead to less engine overhead. We also
    stop obsessing after the details of our <code>Event</code>,
    as we already previously defined it, so we remember
    how to use it.
</p>

<p>
    Since the <code>Event</code> type is not really useful to us,
    as nothing type-hints against it, we can remove it.
    Let's move back to dealing with a structure of
    function pointers:
</p>

<pre><code class="php">function A () {
    $a = [];

    return [
        function ($a1, $a2) use (&amp; $a) {
            $a[$a1][] = $a2;
        },
        function ($a1) use (&amp; $a) {
            if (! array_key_exists($a1, $a)) {
                return false;
            }

            foreach ($a[$a1] as $a2) {
                $a2();
            }

            return true;
        },
    ];
}


$a = A();

$a[0]('subscribed', function () {
    var_dump('handling it');
});

$a[0]('subscribed', function () {
    var_dump('handling it again');
});

$a[1]('subscribed');
</code></pre>

<p>
    This code is equivalent, and doesn't use any
    particularly fancy structures coming from the PHP
    language, such as classes. We are working
    towards reducing the learning and comprehension
    overhead.
</p>

<h2>Conclusion</h2>

<div data-tweet-id="869277621904912389" class="twitter-tweet"></div>

<p>
    If you haven't noticed before, this entire post
    is just
    <a href="https://www.youtube.com/watch?v=82CtZX9gmZ8" target="_blank">
        sarcasm.
    </a>
</p>

<p>
    Please don't do any of what is discussed above, it
    is a badly crafted oxymoron.
</p>

<p>
    Please don't accept what Jeffrey says in that video.
</p>

<p>
    Please do use type systems when they are available,
    they actually reduce "visual debt" (is it even a thing?),
    helping you distinguish apples from pies.
</p>

<p>
    Please do use interfaces, as they reduce clutter,
    making things easier to follow from a consumer perspective,
    be it a human or an automated tool.
</p>

<p>
    This is all you
    need to understand that <code>Event</code> mumbo-jumbo (which
    has broken naming, by the way, but this isn't an
    architecture workshop). Maybe add some API doc:
</p>

<pre><code class="php">interface EventInterface {
    /**
     * Attach an additional listener to be fired when calling 
     * `fire` with `$name`
     */
    public function listen(string $name, callable $handler) : void;

    /**
     * Execute all listeners assigned to `$name`
     *
     * @return bool whether any listener was executed
     */
    public function fire(string $name) : bool;
}
</code></pre>

<p>
    This is not a really good interface, but it's a clear, simple
    and readable one. No "visual debt". Somebody reading this will
    thank you later. Maybe it will be you, next year.
</p>

<p>
    Please <strong>do</strong> follow best practices.
    <a href="https://www.youtube.com/watch?v=8d2AtAGJPno" target="_blank">
        They work.
        They help you avoiding stupid mistakes.
    </a>.
    <a href="http://www.edn.com/design/automotive/4423428/Toyota-s-killer-firmware--Bad-design-and-its-consequences" target="_blank">
        Bad code can lead to terrible consequences, and you don't know where your code will be used.
    </a>
    And yes, I'm picking examples about real-time computing,
    because that's what makes it to the news.
    <a href="https://www.owasp.org/index.php/" target="_blank">
        OWASP
    </a>
    knows more about all this.
</p>

<p>
    Please remember that your job is reading, understanding and thinking
    before typing, and typing is just a side-effect.
</p>

<p>
    And please, please, please: remember that most of your time you are
    not coding for yourself alone. You are coding for your employer, for
    your team, for your project, for your future self.
</p>
        </div>            <p class="tags">
            Tags:            <a href="https://ocramius.github.io/blog/tags/PHP">PHP</a>,            <a href="https://ocramius.github.io/blog/tags/Design">Design</a>,            <a href="https://ocramius.github.io/blog/tags/Type%20Systems">Type Systems</a>,            <a href="https://ocramius.github.io/blog/tags/Visual%20Debt">Visual Debt</a>,            <a href="https://ocramius.github.io/blog/tags/Sarcasm">Sarcasm</a>            </p>            <nav class="article">
                <ul>                        <li>Next: <a class="next" href="https://ocramius.github.io/blog/roave-better-reflection-v2.0" title="BetterReflection version 2.0.0 released"><span class="title">BetterReflection version 2.0.0 released</span></a></li>                        <li>Previous: <a class="previous" href="https://ocramius.github.io/blog/yubikey-for-ssh-gpg-git-and-local-login" title="YubiKey for SSH, Login, 2FA, GPG and Git Signing"><span class="title">YubiKey for SSH, Login, 2FA, GPG and Git Signing</span></a></li>                </ul>
            </nav>        </article>        <div data-tweet-id="869313772002963457" class="twitter-tweet"></div>        
        <div id="disqus_thread"></div>

        <script>
            if (typeof prettyPrint !== 'undefined') {
                $(prettyPrint);
            }
        </script>
        <script>
            var disqus_shortname = 'ocramius-dev';
            var disqus_identifier = '/blog/eliminating-visual-debt';
            var disqus_url = 'https://ocramius.github.io/blog/eliminating-visual-debt';
        </script>
        <script src="https://ocramius-dev.disqus.com/count.js"></script>
        <script src="https://ocramius-dev.disqus.com/embed.js"></script>                        </div>
                        <div class="span4 si debar"></div>
                   </div>
                </div>
            </div>

        </div>

        <script src="https://ocramius.github.io/js/shifty.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.min.js"></script>
        <script src="https://ocramius.github.io/components/bootstrap/js/bootstrap.min.js"></script>
        <script src="https://ocramius.github.io/components/jquery/jquery.min.js"></script>
        <script src ="https://ocramius.github.io/js/blogpost-tweets.js" type="text/javascript"></script>
        <script src="https://platform.twitter.com/widgets.js"></script>        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-33922165-1', 'auto');
            ga('send', 'pageview');
        </script>
        <script src="https://ocramius.github.io/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="https://ocramius.github.io/js/classie.js"></script>
        <script src="https://ocramius.github.io/js/main4.js"></script>
        <script src="https://ocramius.github.io/js/three-js-object-loader.js"></script>
        <script src="https://ocramius.github.io/js/mario.js"></script>
        <script>mario($('#shield-container'), "https://ocramius.github.io/logo/mario");</script>
    </body>
</html>
